/*
 * Quram Qmage image format decoder
 *
 * This file is part of FFmpeg.
 *
 * FFmpeg is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * FFmpeg is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with FFmpeg; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
 */

#include <stdint.h>

static const struct { int8_t x, y; } qmage_dir[3] = {
    [0] = {-1, 0},
    [1] = {0, -1},
    [2] = {-1,-1},
};

static const uint16_t qmage_ori_delta[2][256] = {
    {
        0xffe0, 0x0020, 0xffff, 0xf7e0, 0xf800, 0xffdf, 0x0001, 0x0800,
        0x0021, 0x0820, 0x0841, 0xf7bf, 0xf7df, 0x0821, 0xf7c0, 0xffbf,
        0x0041, 0xffc0, 0x0861, 0x0840, 0x001f, 0x0862, 0xffe1, 0xf79f,
        0x0040, 0xf7ff, 0xf820, 0x0842, 0x1082, 0x07e0, 0xf79e, 0x0801,
        0x1061, 0x1062, 0x07ff, 0xef7e, 0xef9f, 0xf801, 0xf7be, 0xefbf,
        0x0022, 0x0882, 0xefe0, 0xefc0, 0x07df, 0x1041, 0x081f, 0x10a3,
        0x0042, 0x1081, 0xef9e, 0xf7e1, 0xf821, 0xf77e, 0xff9f, 0x10a2,
        0x1040, 0xffbe, 0x1083, 0x1020, 0xef5d, 0xef7f, 0xffde, 0xef5e,
        0x0002, 0x0061, 0xf7a0, 0x18c3, 0xef7d, 0x0822, 0xff9e, 0xf000,
        0x0860, 0xe73d, 0xefa0, 0x0881, 0xefdf, 0x07bf, 0xf77f, 0x0062,
        0xfffe, 0x18a3, 0x10c3, 0x0883, 0x18e4, 0x1060, 0x0863, 0x1000,
        0x18a2, 0xe71c, 0xf7de, 0x1021, 0x1042, 0x18c4, 0xef3d, 0x18e3,
        0xf841, 0xe75d, 0x1881, 0xe73c, 0xe7c0, 0x18c2, 0xe75e, 0xf77d,
        0x10a4, 0x07c0, 0xf81f, 0x10c4, 0xff7e, 0x003f, 0xf840, 0xe79f,
        0x2104, 0xffa0, 0xffc1, 0x18a1, 0xe77f, 0xefbe, 0xf79d, 0x1882,
        0x10a1, 0xe71d, 0x1063, 0xe7a0, 0xe7e0, 0xf7c1, 0x1861, 0x08a3,
        0x1840, 0xe73e, 0x083f, 0xf001, 0xdefc, 0xf75e, 0x0060, 0x2125,
        0x07e1, 0x0fff, 0xef5f, 0xe77e, 0xefe1, 0xe6fc, 0x10c2, 0x08a2,
        0x0023, 0x1860, 0xef3c, 0xef3e, 0x0043, 0xf020, 0xf75d, 0x079f,
        0x101f, 0xdedb, 0xef5c, 0xffe2, 0xf822, 0x20e4, 0x001e, 0x0843,
        0xe7bf, 0x20e3, 0x0082, 0xdefb, 0xef9d, 0x1904, 0xff7f, 0x1820,
        0xe75f, 0x0063, 0xef80, 0x2105, 0x1905, 0xdefd, 0x2124, 0xdf1c,
        0x2103, 0x1080, 0xdf1d, 0xe6fb, 0x07be, 0x2945, 0xdedc, 0xf021,
        0x0fe0, 0xe71b, 0xefff, 0xf842, 0x20c2, 0x079e, 0xf802, 0x0fdf,
        0x20e2, 0x18e2, 0xe780, 0x07de, 0x1880, 0xdfa0, 0x20c1, 0xffbd,
        0x08a4, 0x10e4, 0x18c1, 0xdfc0, 0x103f, 0x0003, 0xdeba, 0xff7d,
        0x1841, 0xe800, 0x20a1, 0xefc1, 0xff9d, 0xf780, 0x18e5, 0x10e3,
        0x1084, 0x0081, 0x2966, 0xffdd, 0x08c3, 0x18a4, 0xdeda, 0xff5e,
        0xdf7f, 0x1883, 0xdebb, 0x2145, 0xd6bb, 0xf7bd, 0x20c3, 0x1903,
        0x077e, 0x0884, 0xf861, 0xe71e, 0x1001, 0xe75c, 0x0083, 0xd6ba,
        0x07fe, 0x2102, 0xdf80, 0x2081, 0x0880, 0xdf3e, 0x2946, 0xe6fd,
        0x2146, 0xef1c, 0xdf9f, 0xdf1e, 0xe73f, 0xe79e, 0x20a2, 0xd69a,
    },
    {
        0xffe0, 0x0020, 0xffff, 0x0001, 0xf800, 0x0800, 0xf7df, 0xffdf,
        0xf7e0, 0x0021, 0xf7bf, 0x0821, 0x0820, 0x0841, 0xf7ff, 0x0801,
        0xffc0, 0x07e0, 0xf820, 0xf801, 0x07ff, 0xf7c0, 0xffe1, 0x0040,
        0x001f, 0xffbf, 0xf79f, 0x0840, 0xffff, 0x0041, 0x0861, 0xef7e,
        0x1082, 0xef9e, 0xf81f, 0xf7a0, 0x0001, 0xe73d, 0xef9f, 0x1062,
        0x0860, 0x1061, 0x18c3, 0x07df, 0xf7be, 0xef5e, 0xefbf, 0xf79e,
        0xf7e1, 0xf821, 0x10a2, 0xef7f, 0x0842, 0x07e1, 0xdefc, 0x1041,
        0x081f, 0x0862, 0x0002, 0x1081, 0x2104, 0xf81f, 0xefc0, 0x07e1,
        0xfffe, 0xffbe, 0xe75d, 0x2945, 0xffa0, 0xf780, 0x1040, 0xd6bb,
        0x0042, 0x18a3, 0x18e3, 0x0880, 0x0822, 0xff9f, 0x0022, 0xffc1,
        0x003f, 0xffde, 0xe71d, 0x3186, 0xef5f, 0xf7de, 0xce7a, 0x0060,
        0x10a1, 0xe75e, 0xf77e, 0xdedc, 0x39c7, 0xf77f, 0xc639, 0x18a2,
        0xefe0, 0x2124, 0x1080, 0x20e4, 0x0061, 0x1020, 0x1000, 0xefa0,
        0xff9e, 0x07c0, 0xdf1c, 0xbdf8, 0x1060, 0xf000, 0x4208, 0xd69b,
        0x0881, 0x5acb, 0x2965, 0x0882, 0xef80, 0xf840, 0xe77f, 0xa535,
        0xe73e, 0xce5a, 0x21ae, 0xf760, 0x1881, 0x4a49, 0xefbe, 0xb5b7,
        0x0062, 0xf7c1, 0x083f, 0x2925, 0xe73f, 0x4a4a, 0xef3f, 0x08a0,
        0xe75f, 0x1042, 0xad76, 0x18c2, 0x3126, 0xf7fe, 0x528a, 0xc619,
        0x31a6, 0xd6db, 0xff7e, 0x10c1, 0xe77e, 0xceda, 0x18c1, 0xb5b6,
        0x07bf, 0xf83f, 0x630c, 0xde52, 0x39e7, 0xefdf, 0xef5d, 0x1861,
        0x10a0, 0xe79f, 0x9cf4, 0xce9a, 0xff7f, 0x18a1, 0x1021, 0x0802,
        0xef7d, 0x1882, 0x3166, 0x0003, 0xf841, 0xf7bd, 0xe71f, 0xdf7f,
        0x10a3, 0x07c1, 0x18e1, 0x94b3, 0x2081, 0xbdd8, 0x6b4d, 0xef60,
        0x1083, 0xdf1d, 0xff7d, 0x0863, 0xf79d, 0xdf3e, 0xf77d, 0x4228,
        0xad56, 0xf7dd, 0x20e3, 0x52aa, 0xb597, 0x3967, 0xc699, 0x20c2,
        0x8c72, 0xff80, 0x001e, 0x39a7, 0xe6ff, 0xff5f, 0xc659, 0x0082,
        0x1901, 0x1063, 0x4a69, 0xef9d, 0x0843, 0xd6dc, 0xfffd, 0x738e,
        0x07fe, 0x8431, 0xffe2, 0xe7a0, 0xef40, 0x7bf0, 0xe71c, 0xff9d,
        0xef3d, 0xefff, 0x2924, 0xa515, 0xd73e, 0x8410, 0x28c2, 0x7bcf,
        0x1043, 0xf75e, 0x41e8, 0x10c3, 0xbe18, 0x5aeb, 0xd6dd, 0xdf5f,
        0x9cd4, 0x0883, 0x20a2, 0xf802, 0x632c, 0xe780, 0x0083, 0xdf5e,
        0xefbd, 0xff5d, 0x0823, 0x1880, 0x1022, 0xdefd, 0x18e4, 0xefde,
    }
};

static const uint16_t qmage_diff[256] = {
    0x0001, 0x0003, 0x0100, 0x0002, 0x0008, 0x0007, 0x0006, 0x0300,
    0x0010, 0x0004, 0x0200, 0x0009, 0x0040, 0x0018, 0x0005, 0x0020,
    0x000c, 0x000e, 0x000f, 0x000a, 0x00c0, 0x0800, 0x0700, 0x0101,
    0x0400, 0x000b, 0x0030, 0x0011, 0x0080, 0x0600, 0x000d, 0x0012,
    0x001c, 0x0500, 0x001b, 0x001e, 0x0014, 0x001a, 0x0028, 0x0038,
    0x1000, 0x001f, 0x0019, 0x0016, 0x0060, 0x2000, 0x0013, 0x001d,
    0x0103, 0x0024, 0x0017, 0x0015, 0x0102, 0x01c0, 0x0f00, 0x003c,
    0x0301, 0x0c00, 0x1800, 0x0048, 0x0021, 0x0034, 0x0e00, 0x0202,
    0x002c, 0x0070, 0x0a00, 0x0303, 0x0036, 0x0201, 0x003f, 0x0d00,
    0x0180, 0x003e, 0x3000, 0x0900, 0x0078, 0x0022, 0x0050, 0x003a,
    0x0041, 0x0107, 0x0033, 0x0106, 0x0026, 0x002a, 0x00a0, 0x0023,
    0x0029, 0x0088, 0x0044, 0x003d, 0x00e0, 0x0032, 0x002e, 0x0039,
    0x0031, 0x002d, 0x00f0, 0x0140, 0x0b00, 0x003b, 0x0058, 0x4000,
    0x0037, 0x0035, 0x0068, 0x0302, 0x007c, 0x002f, 0x0027, 0x0064,
    0x0090, 0x0074, 0x0203, 0x0104, 0x006c, 0x1100, 0x03c0, 0x00ff,
    0x0025, 0xf000, 0x1f00, 0x0701, 0x0042, 0x007f, 0x002b, 0x0105,
    0x0054, 0x1c00, 0x004c, 0x0801, 0x0043, 0x6000, 0x005c, 0x007e,
    0x00e8, 0x0108, 0x00f8, 0xe000, 0x0206, 0x1e00, 0x0380, 0x0061,
    0x007a, 0x004e, 0x0601, 0x1001, 0x00c8, 0x8000, 0x1d00, 0x00d0,
    0x0072, 0x0049, 0x1600, 0x1a00, 0x0046, 0x7000, 0x010f, 0x0110,
    0x0076, 0x1200, 0x1400, 0x0404, 0x0606, 0x010e, 0x00fc, 0x1700,
    0x006e, 0x00fe, 0x1300, 0x0062, 0x0066, 0xc000, 0x0204, 0x0306,
    0x0063, 0x0707, 0x0280, 0x0602, 0x0055, 0x0047, 0x006a, 0x010c,
    0x0052, 0x0501, 0x00d8, 0x0307, 0x0073, 0x0109, 0x0808, 0x0401,
    0x004a, 0x2020, 0x005a, 0x0702, 0x00b0, 0x0045, 0x0207, 0x0304,
    0x0402, 0x005e, 0x010a, 0x0079, 0x3800, 0x00f4, 0x1500, 0x01e0,
    0x1b00, 0x0071, 0x1010, 0x00c1, 0x00e4, 0x0502, 0x0056, 0x007d,
    0x0081, 0x0077, 0x00cc, 0x0703, 0x010d, 0x0205, 0x0340, 0x5000,
    0x0082, 0x0067, 0xff00, 0x0120, 0x0069, 0x0098, 0x00c3, 0x1900,
    0x0065, 0x007b, 0x0240, 0x0603, 0x00ec, 0x0059, 0x00fa, 0x0403,
    0x0075, 0x006f, 0x3100, 0x3300, 0x004f, 0x00b8, 0x006d, 0x0208,
    0x004d, 0x0111, 0x0051, 0x020e, 0x00dc, 0x00c4, 0x2100, 0x00a8,
};
